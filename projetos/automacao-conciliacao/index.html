<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Automa√ß√£o de Concilia√ß√£o | Leiene Neves</title>
  <link rel="stylesheet" href="../../style.css">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
</head>
<body>

<header>
  <div class="container">
    <a href="../../index.html" class="logo-link">
      <img class="logo" src="../../assets/images/logo.png" alt="Voltar ao portf√≥lio">
    </a>
    <nav>
      <ul>
        <li><a href="../../index.html#projects">Voltar aos Projetos</a></li>
      </ul>
    </nav>
  </div>
</header>

<main class="project-detail">
  <div class="container">
    <h1>Automa√ß√£o de Concilia√ß√£o Financeira</h1>

    <div class="project-meta">
      <span class="tech">HTML</span>
      <span class="tech">JavaScript</span>
      <span class="tech">PapaParse</span>
      <a href="#" class="btn disabled">Demo Interna</a>
      <a href="LINK_GITHUB" target="_blank" class="btn secondary">C√≥digo no GitHub</a>
    </div>

    <div class="project-content">
      <section class="project-overview">
        <h2><i class="fas fa-search"></i> Vis√£o Geral</h2>
        <p>Ferramenta web para concilia√ß√£o r√°pida entre lan√ßamentos banc√°rios e registros internos. Permite importar planilhas (.csv), comparar registros e exportar um relat√≥rio de concilia√ß√£o.</p>

        <div class="results-grid">
          <div class="result-card">
            <i class="fas fa-file-csv"></i>
            <strong>Importa√ß√£o</strong>
            <p>de CSVs</p>
          </div>
          <div class="result-card">
            <i class="fas fa-balance-scale"></i>
            <strong>Concilia√ß√£o</strong>
            <p>Data + Valor</p>
          </div>
          <div class="result-card">
            <i class="fas fa-download"></i>
            <strong>Relat√≥rio</strong>
            <p>para download</p>
          </div>
        </div>
      </section>

      <section class="project-screenshots">
        <h2><i class="fas fa-play"></i> Teste a Concilia√ß√£o</h2>
        <div class="reconciliation-tool">
          <div class="file-input">
            <label><strong>Importar Lan√ßamentos Banc√°rios (.csv):</strong></label><br>
            <input type="file" id="bancoFile" accept=".csv">
          </div>

          <div class="file-input">
            <label><strong>Importar Registros Internos (.csv):</strong></label><br>
            <input type="file" id="internoFile" accept=".csv">
          </div>

          <button onclick="conciliar()">Conciliar Arquivos</button>
          <button onclick="baixarRelatorio()">Baixar Relat√≥rio (.csv)</button>

          <div class="results" id="resultado">
            <h3>Resultado:</h3>
            <ul id="listaResultado">
              <li>Aguardando importa√ß√£o e concilia√ß√£o...</li>
            </ul>
          </div>
        </div>
      </section>

      <section class="project-challenges">
        <h2><i class="fas fa-puzzle-piece"></i> Desafios T√©cnicos</h2>
        <ul>
          <li>
            <strong>Problema:</strong> Diferentes formata√ß√µes nos arquivos.<br>
            <strong>Solu√ß√£o:</strong> Normaliza√ß√£o autom√°tica com PapaParse.
          </li>
          <li>
            <strong>Problema:</strong> Concilia√ß√£o manual demorada.<br>
            <strong>Solu√ß√£o:</strong> Automatiza√ß√£o do cruzamento Data + Valor.
          </li>
        </ul>
      </section>
    </div>
  </div>
</main>

<footer>
  <div class="container">
    <p>&copy; <span id="year"></span> Leiene Neves. Todos os direitos reservados.</p>
  </div>
</footer>

<script>
  let dadosBanco = [];
  let dadosInterno = [];
  let resultadoConsolidado = [];
  
  let bancoCarregado = false;
  let internoCarregado = false;
  
  // Importa√ß√£o dos lan√ßamentos banc√°rios
  document.getElementById('bancoFile').addEventListener('change', function(event) {
    Papa.parse(event.target.files[0], {
      header: true,
      skipEmptyLines: true,
      complete: function(results) {
        dadosBanco = results.data;
        bancoCarregado = true;
        alert("Arquivo de lan√ßamentos banc√°rios carregado com sucesso!");
      }
    });
  });
  
  // Importa√ß√£o dos registros internos
  document.getElementById('internoFile').addEventListener('change', function(event) {
    Papa.parse(event.target.files[0], {
      header: true,
      skipEmptyLines: true,
      complete: function(results) {
        dadosInterno = results.data;
        internoCarregado = true;
        alert("Arquivo de registros internos carregado com sucesso!");
      }
    });
  });
  
  // Fun√ß√£o principal de concilia√ß√£o
  function conciliar() {
    const listaResultado = document.getElementById('listaResultado');
    listaResultado.innerHTML = "";
    resultadoConsolidado = [];
  
    if (!bancoCarregado || !internoCarregado) {
      alert("Aguarde a importa√ß√£o completa dos arquivos antes de conciliar!");
      return;
    }
  
    let conciliados = 0;
    let naoConciliados = 0;
  
    dadosBanco.forEach(lancamento => {
      const dataBanco = normalizarData(lancamento.Data);
      const valorBanco = normalizarValor(lancamento.Valor);
  
      const encontrado = dadosInterno.find(registro => {
        const dataInterno = normalizarData(registro.Data);
        const valorInterno = normalizarValor(registro.Valor);
        return dataBanco === dataInterno && valorBanco === valorInterno;
      });
  
      const status = encontrado ? "Conciliado" : "N√£o conciliado";
  
      resultadoConsolidado.push({
        Data: lancamento.Data,
        Valor: lancamento.Valor,
        Descri√ß√£o: lancamento.Descri√ß√£o,
        Status: status
      });
  
      const li = document.createElement('li');
      li.innerHTML = encontrado 
        ? `‚úÖ Conciliado: <strong>${lancamento.Descri√ß√£o}</strong> (${lancamento.Data} - R$${lancamento.Valor})`
        : `‚ö†Ô∏è N√£o conciliado: <strong>${lancamento.Descri√ß√£o}</strong> (${lancamento.Data} - R$${lancamento.Valor})`;
      listaResultado.appendChild(li);
  
      if (encontrado) {
        conciliados++;
      } else {
        naoConciliados++;
      }
    });
  
    // Exibe resumo final
    const resumo = document.createElement('li');
    resumo.style.marginTop = '20px';
    resumo.style.fontWeight = 'bold';
    resumo.innerHTML = `
      üìÑ Total de lan√ßamentos: ${conciliados + naoConciliados}<br>
      ‚úÖ Conciliados: ${conciliados}<br>
      ‚ö†Ô∏è N√£o conciliados: ${naoConciliados}
    `;
    listaResultado.appendChild(resumo);
  }
  
  // Fun√ß√£o para normalizar valores (R$ etc.)
  function normalizarValor(valor) {
    if (!valor) return 0;
    return parseFloat(valor.replace(/[^\d,.-]/g, '').replace(',', '.')) || 0;
  }
  
  // Fun√ß√£o para normalizar datas (dd/mm/yyyy ‚Üí yyyy-mm-dd)
  function normalizarData(data) {
    if (!data) return '';
    const parts = data.includes('/') ? data.split('/') : data.split('-');
    if (parts.length === 3) {
      if (data.includes('/')) {
        // Formato brasileiro (dd/mm/yyyy)
        return `${parts[2]}-${parts[1].padStart(2, '0')}-${parts[0].padStart(2, '0')}`;
      } else {
        // Formato ISO (yyyy-mm-dd)
        return data;
      }
    }
    return data;
  }
  
  // Fun√ß√£o para baixar relat√≥rio consolidado
  function baixarRelatorio() {
    if (resultadoConsolidado.length === 0) {
      alert("Realize a concilia√ß√£o antes de baixar o relat√≥rio!");
      return;
    }
  
    const csv = Papa.unparse(resultadoConsolidado);
  
    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    const url = URL.createObjectURL(blob);
  
    const link = document.createElement('a');
    link.setAttribute('href', url);
    link.setAttribute('download', 'relatorio_conciliacao.csv');
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  }
  </script>
  
  <script>
    // Atualiza o ano automaticamente no rodap√©
    document.getElementById("year").textContent = new Date().getFullYear();
  </script>
    

</body>
</html>
